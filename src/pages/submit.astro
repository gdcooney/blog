---
import Layout from "src/layouts/Layout.astro";
import Header from "src/components/Header.astro";
import Footer from "src/components/Footer.astro";
---

<Layout>
  <Header />
  <body class="px-4 py-8 max-w-3xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">Submit a Post</h1>

    <form id="blog-form" class="space-y-4">
      <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4">
        <div class="flex-1">
          <label for="title" class="block font-medium">Title</label>
          <input type="text" id="title" required class="w-full px-3 py-2 border rounded bg-gray-900 text-white" />
        </div>

        <div class="w-full sm:w-1/3 mt-4 sm:mt-0">
          <label for="date" class="block font-medium">Date</label>
          <input type="date" id="date" class="w-full px-3 py-2 border rounded bg-gray-900 text-white" />
        </div>
      </div>

      <div>
        <label for="tags" class="block font-medium">Tags</label>
        <input type="text" id="tags" placeholder="comma,separated,tags" class="w-full px-3 py-2 border rounded bg-gray-900 text-white" />
      </div>

      <div>
        <label for="content" class="block font-medium">Markdown</label>
        <textarea id="content" rows="15" class="w-full px-3 py-2 border rounded bg-gray-900 text-white"></textarea>
      </div>

      <div class="text-right">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Submit</button>
      </div>
    </form>
<script>
  const form = document.getElementById("blog-form");
  if (form instanceof HTMLFormElement) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const titleEl = document.getElementById("title");
      const tagsEl = document.getElementById("tags");
      const contentEl = document.getElementById("content");

      if (
        !(titleEl instanceof HTMLInputElement) ||
        !(tagsEl instanceof HTMLInputElement) ||
        !(contentEl instanceof HTMLTextAreaElement)
      ) return;

      const payload = {
        title: titleEl.value,
        tags: tagsEl.value.split(",").map(tag => tag.trim()).filter(Boolean),
        notes: "",
        data: { content: contentEl.value }
      };

      const res = await fetch("/api/get-presigned-url", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        form.reset();
        alert("Log submitted successfully!");
      } else {
        alert("Failed to submit log.");
      }
    });
  } else {
    console.error("Form not found or is not a form element");
  }
</script>


  </body>
  <Footer />
</Layout>

